<!-- campaign_form.html (modified) -->
{% extends 'dmbot/base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <!-- Header -->
        <div class="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-primary to-secondary">
            <h2 class="text-2xl font-bold text-white">Create DM Campaign</h2>
            <p class="mt-1 text-sm text-indigo-100">Choose a mode and launch a new automated messaging campaign</p>
        </div>

        {% if not templates %}
        <!-- No Templates Warning -->
        <div class="p-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-start">
                    <svg class="w-6 h-6 text-yellow-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <h3 class="text-sm font-medium text-yellow-900">No Active Templates</h3>
                        <p class="mt-1 text-sm text-yellow-700">You need to create a DM template before launching a campaign.</p>
                        <a href="{% url 'template_form' %}" class="mt-3 inline-flex items-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium">
                            Create Template
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- Campaign Form -->
        <form method="post" class="p-6 space-y-6">
            {% csrf_token %}
            <!-- Mode Selection -->
            <div>
                <label for="mode" class="block text-sm font-medium text-gray-700 mb-2">
                    Campaign Mode <span class="text-red-500">*</span>
                </label>
                <select
                    id="mode"
                    name="mode"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                    onchange="toggleFormFields(this.value)"
                >
                    <option value="campaign" {% if mode == 'campaign' %}selected{% endif %}>Campaign-Based</option>
                    <option value="csv" {% if mode == 'csv' %}selected{% endif %}>CSV-Based</option>
                </select>
            </div>

            <div id="campaign-fields" class="{% if mode == 'csv' %}hidden{% endif %}">
                <!-- Campaign Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        Campaign Name <span class="text-red-500">*</span>
                    </label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                        placeholder="e.g., Photography Outreach Q4"
                    >
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Template Selection -->
                    <div>
                        <label for="template_id" class="block text-sm font-medium text-gray-700 mb-2">
                            DM Template <span class="text-red-500">*</span>
                        </label>
                        <select
                            id="template_id"
                            name="template_id"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                        >
                            <option value="">Select a template</option>
                            {% for template in templates %}
                                <option value="{{ template.id }}">
                                    {{ template.name }} - {{ template.category|capfirst|default:"General" }} ({{ template.success_rate|floatformat:1 }}% success)
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Account Selection -->
                    <div>
                        <label for="accounts" class="block text-sm font-medium text-gray-700 mb-2">
                            Accounts <span class="text-red-500">*</span>
                        </label>
                        <select
                            id="accounts"
                            name="accounts"
                            multiple
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow h-32"
                        >
                            {% for account in accounts %}
                                <option value="{{ account.id }}">
                                    {{ account.username }} (Health: {{ account.health_score }}%)
                                </option>
                            {% endfor %}
                        </select>
                        <p class="mt-2 text-xs text-gray-500">Hold Ctrl (Windows) or Cmd (Mac) to select multiple</p>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-base font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                        </svg>
                        Target Filters (Optional)
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <!-- Professions -->
                        <div>
                            <label for="professions" class="block text-sm font-medium text-gray-700 mb-2">
                                Professions
                            </label>
                            <input
                                type="text"
                                id="professions"
                                name="professions"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                                placeholder="e.g., photographer, artist"
                            >
                        </div>

                        <!-- Countries -->
                        <div>
                            <label for="countries" class="block text-sm font-medium text-gray-700 mb-2">
                                Countries
                            </label>
                            <input
                                type="text"
                                id="countries"
                                name="countries"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                                placeholder="e.g., usa, uk, canada"
                            >
                        </div>

                        <!-- Keywords -->
                        <div>
                            <label for="keywords" class="block text-sm font-medium text-gray-700 mb-2">
                                Keywords
                            </label>
                            <input
                                type="text"
                                id="keywords"
                                name="keywords"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow"
                                placeholder="e.g., creative, design"
                            >
                        </div>
                    </div>
                    <p class="mt-3 text-xs text-gray-500">Filters help target specific user segments. Leave blank to target all scraped users.</p>
                </div>
            </div>

            <!-- Info Box -->
            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                <div class="flex items-start">
                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <h3 class="text-sm font-medium text-purple-900">Campaign Best Practices</h3>
                        <ul class="mt-2 text-sm text-purple-700 space-y-1 list-disc list-inside">
                            <li>Use warm accounts with high health scores for better results</li>
                            <li>Apply filters for campaign mode or upload a CSV with specific messages</li>
                            <li>Monitor campaign performance and adjust as needed</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                <a href="{% url 'status' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Cancel
                </a>
                <button type="submit" class="inline-flex items-center px-6 py-2 bg-gradient-to-r from-primary to-secondary text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all shadow-sm font-medium">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Launch Campaign
                </button>
            </div>
        </form>
        {% endif %}
    </div>

    <!-- Quick Stats -->
    {% if templates %}
    <div class="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="bg-white rounded-lg border border-gray-200 p-4">
            <div class="flex items-center">
                <div class="bg-blue-100 rounded-lg p-3 mr-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <div>
                    <p class="text-xs text-gray-500">Templates</p>
                    <p class="text-lg font-semibold text-gray-900">{{ templates|length }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 p-4">
            <div class="flex items-center">
                <div class="bg-green-100 rounded-lg p-3 mr-3">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <p class="text-xs text-gray-500">Ready Accounts</p>
                    <p class="text-lg font-semibold text-gray-900">{{ accounts|length }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 p-4">
            <div class="flex items-center">
                <div class="bg-purple-100 rounded-lg p-3 mr-3">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <div>
                    <p class="text-xs text-gray-500">Avg Health</p>
                    <p class="text-lg font-semibold text-gray-900">{% widthratio accounts|length 1 1 %}%</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function toggleFormFields(mode) {
        const campaignFields = document.getElementById('campaign-fields');
        if (mode === 'csv') {
            campaignFields.classList.add('hidden');
            document.getElementById('name').removeAttribute('required');
            document.getElementById('template_id').removeAttribute('required');
            document.getElementById('accounts').removeAttribute('required');
        } else {
            campaignFields.classList.remove('hidden');
            document.getElementById('name').setAttribute('required', '');
            document.getElementById('template_id').setAttribute('required', '');
            document.getElementById('accounts').setAttribute('required', '');
        }
    }
</script>
{% endblock %}